#include "triangleelement.h"

#include <GL/gl.h>
#include <cmath>
#include <QDebug>
#include <iostream>
#include <string>

MC::TriangleElement::TriangleElement()
{
}

MC::TriangleElement::TriangleElement(double x0, double y0, double x1, double y1, double x2, double y2,
                                     double x3, double y3, double x4, double y4, double x5, double y5)
{

    //    double L = 1.0;

    //    x0 = 0.0;
    //    x2 = L;
    //    x4 = 0.0;

    //    y0 = 0.0;
    //    y2 = 0.0;
    //    y4 = L;



    //    x1 = 0.5*(x0+x2);
    //    x3 = 0.5*(x4+x2);
    //    x5 = 0.5*(x4+x0);

    //    y1 = 0.5*(y0+y2);
    //    y3 = 0.5*(y4+y2);
    //    y5 = 0.5*(y4+y0);

    double coef[9];

    this->N = new MC::Polynomial2D[6];

    double triangleArea_inv2 = 1.0/fabs((x2*y4+x0*y2+y0*x4) - (y0*x2+y2*x4+y4*x0));

    // L1
    coef[0] = (x2*y4 - x4*y2)*triangleArea_inv2;
    coef[1] = (y2 - y4)*triangleArea_inv2;
    coef[2] = (x4 - x2)*triangleArea_inv2;

    MC::Polynomial2D L1(1,coef);


    // L2
    coef[0] = (x4*y0 - x0*y4)*triangleArea_inv2;
    coef[1] = (y4 - y0)*triangleArea_inv2;
    coef[2] = (x0 - x4)*triangleArea_inv2;

    MC::Polynomial2D L2(1,coef);


    // L3
    coef[0] = (x0*y2 - x2*y0)*triangleArea_inv2;
    coef[1] = (y0 - y2)*triangleArea_inv2;
    coef[2] = (x2 - x0)*triangleArea_inv2;

    MC::Polynomial2D L3(1,coef);


    N[0] = L1*L1*2.0-L1; //(2.0*L1-1)*L1;
    N[2] = L2*L2*2.0-L2;
    N[4] = L3*L3*2.0-L3;

    N[1] = L1*L2*4.0;
    N[3] = L2*L3*4.0;
    N[5] = L3*L1*4.0;


    //    coef[0] = x2; // 1
    //    coef[1] = -1.*x0-3.*x2+4.*x5; // x
    //    coef[2] = -1.*x1-3.*x2+4.*x4; // y
    //    coef[3] = 4.*(x2+x3-x4-x5); // xy
    //    coef[4] = 2.*(x1+x2-2.*x4); // x²
    //    coef[5] = 2.*(x0+x2-2.*x5); // y²

    coef[0] = x4; // 1
    coef[1] = -x0-3.*x4+4.*x5; // x
    coef[2] = 2.*(x0-2.*x5+x4); // x²
    coef[3] = -x2-3.*x4+4.*x3; // y
    coef[4] = 4.*(x1-x3+x4-x5); // xy
    coef[5] = 0.0; // x²y
    coef[6] = 2.*(x2-2.*x3+x4); // y²
    coef[7] = 0.0; // y²x
    coef[8] = 0.0; // x²y²



    X = MC::Polynomial2D(2,coef);

    coef[0] = y4; // 1
    coef[1] = -y0-3.*y4+4.*y5; // x
    coef[2] = 2.*(y0-2.*y5+y4); // x²
    coef[3] = -y2-3.*y4+4.*y3; // y
    coef[4] = 4.*(y1-y3+y4-y5); // xy
    coef[5] = 0.0; // x²y
    coef[6] = 2.*(y2-2.*y3+y4); // y²
    coef[7] = 0.0; // y²x
    coef[8] = 0.0; // x²y²


    Y = MC::Polynomial2D(2,coef);

    //    std::cout<<"\nX = "<<X;
    //    std::cout<<"\nY = "<<Y;




    //    glColor3d(0.0, 1.0, 1.0);
    //    glLineWidth(2.);

    //    glBegin(GL_LINES);{
    //        glVertex2d(x0, y0);
    //        glVertex2d(x2, y2);

    //        glVertex2d(x2, y2);
    //        glVertex2d(x4, y4);

    //        glVertex2d(x4, y4);
    //        glVertex2d(x0, y0);
    //    }
    //    glEnd();

    //    glColor4d(0.0, 1.0, 0.5, 0.4);
    //    glBegin(GL_TRIANGLES);{
    //        glVertex2d(x0, y0);

    //        glVertex2d(x2, y2);

    //        glVertex2d(x4, y4);
    //    }
    //    glEnd();


    pts = new double[12];
    w = new double[13];
    px = new double[13];
    py = new double[13];

    pts[0] = x0;
    pts[1] = y0;
    pts[2] = x2;
    pts[3] = y2;
    pts[4] = x4;
    pts[5] = y4;
    pts[6] = x1;
    pts[7] = y1;
    pts[8] = x3;
    pts[9] = y3;
    pts[10] = x5;
    pts[11] = y5;

    updateWPGauss();



}

void MC::TriangleElement::updateWPGauss()
{
    w[0] = -.149570044467670*fabs(.1111111111111107*pts[0]*pts[3]-.1111111111111114*pts[0]*pts[5]+.4444444444444444*pts[0]*pts[7]-.4444444444444444*pts[0]*pts[11]-.1111111111111110*pts[4]*pts[3]-.4444444444444463*pts[4]*pts[9]+.4444444444444464*pts[4]*pts[11]+.4444444444444422*pts[6]*pts[3]+1.777777777777780*pts[6]*pts[9]-1.777777777777779*pts[6]*pts[11]-.4444444444444422*pts[8]*pts[3]+.4444444444444463*pts[8]*pts[5]-1.777777777777780*pts[8]*pts[7]+1.777777777777776*pts[8]*pts[11]-.4444444444444464*pts[10]*pts[5]+1.777777777777779*pts[10]*pts[7]-1.777777777777776*pts[10]*pts[9]-.1111111111111107*pts[1]*pts[2]+.1111111111111114*pts[1]*pts[4]-.4444444444444444*pts[1]*pts[6]+.4444444444444444*pts[1]*pts[10]+.1111111111111110*pts[5]*pts[2]-.4444444444444422*pts[7]*pts[2]+.4444444444444422*pts[9]*pts[2]-4.444444444444457e-16*pts[4]*pts[7]+1.000000000000000e-15*pts[0]*pts[9]+4.444444444444457e-16*pts[6]*pts[5]+6.666666666666640e-16*pts[10]*pts[3]-6.666666666666640e-16*pts[11]*pts[2]-1.000000000000000e-15*pts[1]*pts[8]);
    w[1] = .175615257433204*fabs(0.3795861586467648e-1*pts[0]*pts[3]-0.3795861586468015e-1*pts[0]*pts[5]+1.758547311006027*pts[0]*pts[7]-1.758547311006027*pts[0]*pts[11]-0.1712624225737844e-2*pts[4]*pts[3]-0.3624599163894230e-1*pts[4]*pts[7]-0.4309648854189401e-1*pts[4]*pts[9]+0.4309648854189401e-1*pts[4]*pts[11]+0.4309648854188968e-1*pts[6]*pts[3]+0.3624599163894230e-1*pts[6]*pts[5]+1.996574751548525*pts[6]*pts[9]-.3173699207233292*pts[6]*pts[11]-0.4309648854188968e-1*pts[8]*pts[3]+0.4309648854189401e-1*pts[8]*pts[5]-1.996574751548525*pts[8]*pts[7]+1.996574751548524*pts[8]*pts[11]-0.3624599163893863e-1*pts[10]*pts[3]-0.4309648854189401e-1*pts[10]*pts[5]+.3173699207233292*pts[10]*pts[7]-1.996574751548524*pts[10]*pts[9]-0.3795861586467648e-1*pts[1]*pts[2]+0.3795861586468015e-1*pts[1]*pts[4]-1.758547311006027*pts[1]*pts[6]+1.758547311006027*pts[1]*pts[10]+0.1712624225737844e-2*pts[5]*pts[2]-0.4309648854188968e-1*pts[7]*pts[2]+0.4309648854188968e-1*pts[9]*pts[2]+0.3624599163893863e-1*pts[11]*pts[2]+3.668929085470768e-15*pts[0]*pts[9]-3.668929085470768e-15*pts[1]*pts[8]);
    //w[2] = .175615257433204*fabs(-3.668929085470768e-15*pts[1]*pts[8]+0.3795861586467648e-1*pts[0]*pts[3]-0.3795861586468015e-1*pts[0]*pts[5]+1.758547311006027*pts[0]*pts[7]-1.758547311006027*pts[0]*pts[11]-0.1712624225737844e-2*pts[4]*pts[3]-0.3624599163894230e-1*pts[4]*pts[7]-0.4309648854189401e-1*pts[4]*pts[9]+0.4309648854189401e-1*pts[4]*pts[11]+0.4309648854188968e-1*pts[6]*pts[3]+0.3624599163894230e-1*pts[6]*pts[5]+1.996574751548525*pts[6]*pts[9]-.3173699207233292*pts[6]*pts[11]-0.4309648854188968e-1*pts[8]*pts[3]+0.4309648854189401e-1*pts[8]*pts[5]-1.996574751548525*pts[8]*pts[7]+1.996574751548524*pts[8]*pts[11]-0.3624599163893863e-1*pts[10]*pts[3]-0.4309648854189401e-1*pts[10]*pts[5]+.3173699207233292*pts[10]*pts[7]-1.996574751548524*pts[10]*pts[9]-0.3795861586467648e-1*pts[1]*pts[2]+0.3795861586468015e-1*pts[1]*pts[4]-1.758547311006027*pts[1]*pts[6]+1.758547311006027*pts[1]*pts[10]+0.1712624225737844e-2*pts[5]*pts[2]-0.4309648854188968e-1*pts[7]*pts[2]+0.4309648854188968e-1*pts[9]*pts[2]+0.3624599163893863e-1*pts[11]*pts[2]+3.668929085470768e-15*pts[0]*pts[9]);
    //w[3] = .175615257433204*fabs(-3.668929085470768e-15*pts[1]*pts[8]+0.3795861586467648e-1*pts[0]*pts[3]-0.3795861586468015e-1*pts[0]*pts[5]+1.758547311006027*pts[0]*pts[7]-1.758547311006027*pts[0]*pts[11]-0.1712624225737844e-2*pts[4]*pts[3]-0.3624599163894230e-1*pts[4]*pts[7]-0.4309648854189401e-1*pts[4]*pts[9]+0.4309648854189401e-1*pts[4]*pts[11]+0.4309648854188968e-1*pts[6]*pts[3]+0.3624599163894230e-1*pts[6]*pts[5]+1.996574751548525*pts[6]*pts[9]-.3173699207233292*pts[6]*pts[11]-0.4309648854188968e-1*pts[8]*pts[3]+0.4309648854189401e-1*pts[8]*pts[5]-1.996574751548525*pts[8]*pts[7]+1.996574751548524*pts[8]*pts[11]-0.3624599163893863e-1*pts[10]*pts[3]-0.4309648854189401e-1*pts[10]*pts[5]+.3173699207233292*pts[10]*pts[7]-1.996574751548524*pts[10]*pts[9]-0.3795861586467648e-1*pts[1]*pts[2]+0.3795861586468015e-1*pts[1]*pts[4]-1.758547311006027*pts[1]*pts[6]+1.758547311006027*pts[1]*pts[10]+0.1712624225737844e-2*pts[5]*pts[2]-0.4309648854188968e-1*pts[7]*pts[2]+0.4309648854188968e-1*pts[9]*pts[2]+0.3624599163893863e-1*pts[11]*pts[2]+3.668929085470768e-15*pts[0]*pts[9]);
    w[4] = 0.53347235608839e-1*fabs(1.833139711685384*pts[0]*pts[3]-1.833139711685384*pts[0]*pts[5]-8.624197776935312*pts[0]*pts[7]+8.624197776935312*pts[0]*pts[11]+.5468300616471239*pts[4]*pts[3]-2.379969773332508*pts[4]*pts[7]-.1926495267440121*pts[4]*pts[9]+.1926495267440121*pts[4]*pts[11]+.1926495267440121*pts[6]*pts[3]+2.379969773332508*pts[6]*pts[5]-.9063398767057522*pts[6]*pts[9]-10.29047720030608*pts[6]*pts[11]-.1926495267440121*pts[8]*pts[3]+.1926495267440121*pts[8]*pts[5]+.9063398767057522*pts[8]*pts[7]-.9063398767057522*pts[8]*pts[11]-2.379969773332508*pts[10]*pts[3]-.1926495267440121*pts[10]*pts[5]+10.29047720030608*pts[10]*pts[7]+.9063398767057522*pts[10]*pts[9]-1.833139711685384*pts[1]*pts[2]+1.833139711685384*pts[1]*pts[4]+8.624197776935312*pts[1]*pts[6]-8.624197776935312*pts[1]*pts[10]-.5468300616471239*pts[5]*pts[2]-.1926495267440121*pts[7]*pts[2]+.1926495267440121*pts[9]*pts[2]+2.379969773332508*pts[11]*pts[2]);
    //w[5] = 0.53347235608839e-1*fabs(1.833139711685384*pts[0]*pts[3]-1.833139711685384*pts[0]*pts[5]-8.624197776935312*pts[0]*pts[7]+8.624197776935312*pts[0]*pts[11]+.5468300616471239*pts[4]*pts[3]-2.379969773332508*pts[4]*pts[7]-.1926495267440121*pts[4]*pts[9]+.1926495267440121*pts[4]*pts[11]+.1926495267440121*pts[6]*pts[3]+2.379969773332508*pts[6]*pts[5]-.9063398767057522*pts[6]*pts[9]-10.29047720030608*pts[6]*pts[11]-.1926495267440121*pts[8]*pts[3]+.1926495267440121*pts[8]*pts[5]+.9063398767057522*pts[8]*pts[7]-.9063398767057522*pts[8]*pts[11]-2.379969773332508*pts[10]*pts[3]-.1926495267440121*pts[10]*pts[5]+10.29047720030608*pts[10]*pts[7]+.9063398767057522*pts[10]*pts[9]-1.833139711685384*pts[1]*pts[2]+1.833139711685384*pts[1]*pts[4]+8.624197776935312*pts[1]*pts[6]-8.624197776935312*pts[1]*pts[10]-.5468300616471239*pts[5]*pts[2]-.1926495267440121*pts[7]*pts[2]+.1926495267440121*pts[9]*pts[2]+2.379969773332508*pts[11]*pts[2]);
    //w[6] = 0.53347235608839e-1*fabs(1.833139711685384*pts[0]*pts[3]-1.833139711685384*pts[0]*pts[5]-8.624197776935312*pts[0]*pts[7]+8.624197776935312*pts[0]*pts[11]+.5468300616471239*pts[4]*pts[3]-2.379969773332508*pts[4]*pts[7]-.1926495267440121*pts[4]*pts[9]+.1926495267440121*pts[4]*pts[11]+.1926495267440121*pts[6]*pts[3]+2.379969773332508*pts[6]*pts[5]-.9063398767057522*pts[6]*pts[9]-10.29047720030608*pts[6]*pts[11]-.1926495267440121*pts[8]*pts[3]+.1926495267440121*pts[8]*pts[5]+.9063398767057522*pts[8]*pts[7]-.9063398767057522*pts[8]*pts[11]-2.379969773332508*pts[10]*pts[3]-.1926495267440121*pts[10]*pts[5]+10.29047720030608*pts[10]*pts[7]+.9063398767057522*pts[10]*pts[9]-1.833139711685384*pts[1]*pts[2]+1.833139711685384*pts[1]*pts[4]+8.624197776935312*pts[1]*pts[6]-8.624197776935312*pts[1]*pts[10]-.5468300616471239*pts[5]*pts[2]-.1926495267440121*pts[7]*pts[2]+.1926495267440121*pts[9]*pts[2]+2.379969773332508*pts[11]*pts[2]);
    w[7] = 0.77113760890257e-1*fabs(.3907157853544358*pts[0]*pts[3]+1.251161233213717*pts[0]*pts[5]+3.967998956417753*pts[0]*pts[7]-1.641877018568153*pts[0]*pts[9]-3.967998956417753*pts[0]*pts[11]+.2024869307419591*pts[4]*pts[3]+1.048674302471758*pts[4]*pts[7]+.1568293126417958*pts[4]*pts[9]-.1568293126417958*pts[4]*pts[11]+.3146951134265233*pts[6]*pts[3]-1.048674302471758*pts[6]*pts[5]+1.873533741185953*pts[6]*pts[9]+2.828444404277035*pts[6]*pts[11]-.3146951134265233*pts[8]*pts[3]-.1568293126417958*pts[8]*pts[5]-1.873533741185953*pts[8]*pts[7]+.7031811486861195*pts[8]*pts[11]-.5932027160963949*pts[10]*pts[3]+.1568293126417958*pts[10]*pts[5]-2.828444404277035*pts[10]*pts[7]-.7031811486861195*pts[10]*pts[9]-.3907157853544358*pts[1]*pts[2]-1.251161233213717*pts[1]*pts[4]-3.967998956417753*pts[1]*pts[6]+1.641877018568153*pts[1]*pts[8]+3.967998956417753*pts[1]*pts[10]-.2024869307419591*pts[5]*pts[2]-.3146951134265233*pts[7]*pts[2]+.3146951134265233*pts[9]*pts[2]+.5932027160963949*pts[11]*pts[2]);
    //w[8] = 0.77113760890257e-1*fabs(.3907157853544358*pts[0]*pts[3]+1.251161233213717*pts[0]*pts[5]+3.967998956417753*pts[0]*pts[7]-1.641877018568153*pts[0]*pts[9]-3.967998956417753*pts[0]*pts[11]+.2024869307419591*pts[4]*pts[3]+1.048674302471758*pts[4]*pts[7]+.1568293126417958*pts[4]*pts[9]-.1568293126417958*pts[4]*pts[11]+.3146951134265233*pts[6]*pts[3]-1.048674302471758*pts[6]*pts[5]+1.873533741185953*pts[6]*pts[9]+2.828444404277035*pts[6]*pts[11]-.3146951134265233*pts[8]*pts[3]-.1568293126417958*pts[8]*pts[5]-1.873533741185953*pts[8]*pts[7]+.7031811486861195*pts[8]*pts[11]-.5932027160963949*pts[10]*pts[3]+.1568293126417958*pts[10]*pts[5]-2.828444404277035*pts[10]*pts[7]-.7031811486861195*pts[10]*pts[9]-.3907157853544358*pts[1]*pts[2]-1.251161233213717*pts[1]*pts[4]-3.967998956417753*pts[1]*pts[6]+1.641877018568153*pts[1]*pts[8]+3.967998956417753*pts[1]*pts[10]-.2024869307419591*pts[5]*pts[2]-.3146951134265233*pts[7]*pts[2]+.3146951134265233*pts[9]*pts[2]+.5932027160963949*pts[11]*pts[2]);
    //w[9] = 0.77113760890257e-1*fabs(.3907157853544358*pts[0]*pts[3]+1.251161233213717*pts[0]*pts[5]+3.967998956417753*pts[0]*pts[7]-1.641877018568153*pts[0]*pts[9]-3.967998956417753*pts[0]*pts[11]+.2024869307419591*pts[4]*pts[3]+1.048674302471758*pts[4]*pts[7]+.1568293126417958*pts[4]*pts[9]-.1568293126417958*pts[4]*pts[11]+.3146951134265233*pts[6]*pts[3]-1.048674302471758*pts[6]*pts[5]+1.873533741185953*pts[6]*pts[9]+2.828444404277035*pts[6]*pts[11]-.3146951134265233*pts[8]*pts[3]-.1568293126417958*pts[8]*pts[5]-1.873533741185953*pts[8]*pts[7]+.7031811486861195*pts[8]*pts[11]-.5932027160963949*pts[10]*pts[3]+.1568293126417958*pts[10]*pts[5]-2.828444404277035*pts[10]*pts[7]-.7031811486861195*pts[10]*pts[9]-.3907157853544358*pts[1]*pts[2]-1.251161233213717*pts[1]*pts[4]-3.967998956417753*pts[1]*pts[6]+1.641877018568153*pts[1]*pts[8]+3.967998956417753*pts[1]*pts[10]-.2024869307419591*pts[5]*pts[2]-.3146951134265233*pts[7]*pts[2]+.3146951134265233*pts[9]*pts[2]+.5932027160963949*pts[11]*pts[2]);
    //w[10] = 0.77113760890257e-1*fabs(.3907157853544358*pts[0]*pts[3]+1.251161233213717*pts[0]*pts[5]+3.967998956417753*pts[0]*pts[7]-1.641877018568153*pts[0]*pts[9]-3.967998956417753*pts[0]*pts[11]+.2024869307419591*pts[4]*pts[3]+1.048674302471758*pts[4]*pts[7]+.1568293126417958*pts[4]*pts[9]-.1568293126417958*pts[4]*pts[11]+.3146951134265233*pts[6]*pts[3]-1.048674302471758*pts[6]*pts[5]+1.873533741185953*pts[6]*pts[9]+2.828444404277035*pts[6]*pts[11]-.3146951134265233*pts[8]*pts[3]-.1568293126417958*pts[8]*pts[5]-1.873533741185953*pts[8]*pts[7]+.7031811486861195*pts[8]*pts[11]-.5932027160963949*pts[10]*pts[3]+.1568293126417958*pts[10]*pts[5]-2.828444404277035*pts[10]*pts[7]-.7031811486861195*pts[10]*pts[9]-.3907157853544358*pts[1]*pts[2]-1.251161233213717*pts[1]*pts[4]-3.967998956417753*pts[1]*pts[6]+1.641877018568153*pts[1]*pts[8]+3.967998956417753*pts[1]*pts[10]-.2024869307419591*pts[5]*pts[2]-.3146951134265233*pts[7]*pts[2]+.3146951134265233*pts[9]*pts[2]+.5932027160963949*pts[11]*pts[2]);
    //w[11] = 0.77113760890257e-1*fabs(.3907157853544358*pts[0]*pts[3]+1.251161233213717*pts[0]*pts[5]+3.967998956417753*pts[0]*pts[7]-1.641877018568153*pts[0]*pts[9]-3.967998956417753*pts[0]*pts[11]+.2024869307419591*pts[4]*pts[3]+1.048674302471758*pts[4]*pts[7]+.1568293126417958*pts[4]*pts[9]-.1568293126417958*pts[4]*pts[11]+.3146951134265233*pts[6]*pts[3]-1.048674302471758*pts[6]*pts[5]+1.873533741185953*pts[6]*pts[9]+2.828444404277035*pts[6]*pts[11]-.3146951134265233*pts[8]*pts[3]-.1568293126417958*pts[8]*pts[5]-1.873533741185953*pts[8]*pts[7]+.7031811486861195*pts[8]*pts[11]-.5932027160963949*pts[10]*pts[3]+.1568293126417958*pts[10]*pts[5]-2.828444404277035*pts[10]*pts[7]-.7031811486861195*pts[10]*pts[9]-.3907157853544358*pts[1]*pts[2]-1.251161233213717*pts[1]*pts[4]-3.967998956417753*pts[1]*pts[6]+1.641877018568153*pts[1]*pts[8]+3.967998956417753*pts[1]*pts[10]-.2024869307419591*pts[5]*pts[2]-.3146951134265233*pts[7]*pts[2]+.3146951134265233*pts[9]*pts[2]+.5932027160963949*pts[11]*pts[2]);
    //w[12] = 0.77113760890257e-1*fabs(.3907157853544358*pts[0]*pts[3]+1.251161233213717*pts[0]*pts[5]+3.967998956417753*pts[0]*pts[7]-1.641877018568153*pts[0]*pts[9]-3.967998956417753*pts[0]*pts[11]+.2024869307419591*pts[4]*pts[3]+1.048674302471758*pts[4]*pts[7]+.1568293126417958*pts[4]*pts[9]-.1568293126417958*pts[4]*pts[11]+.3146951134265233*pts[6]*pts[3]-1.048674302471758*pts[6]*pts[5]+1.873533741185953*pts[6]*pts[9]+2.828444404277035*pts[6]*pts[11]-.3146951134265233*pts[8]*pts[3]-.1568293126417958*pts[8]*pts[5]-1.873533741185953*pts[8]*pts[7]+.7031811486861195*pts[8]*pts[11]-.5932027160963949*pts[10]*pts[3]+.1568293126417958*pts[10]*pts[5]-2.828444404277035*pts[10]*pts[7]-.7031811486861195*pts[10]*pts[9]-.3907157853544358*pts[1]*pts[2]-1.251161233213717*pts[1]*pts[4]-3.967998956417753*pts[1]*pts[6]+1.641877018568153*pts[1]*pts[8]+3.967998956417753*pts[1]*pts[10]-.2024869307419591*pts[5]*pts[2]-.3146951134265233*pts[7]*pts[2]+.3146951134265233*pts[9]*pts[2]+.5932027160963949*pts[11]*pts[2]);

    w[2]=w[3]=w[1];
    w[5]=w[6]=w[4];
    w[8]=w[9]=w[10]=w[11]=w[12]=w[7];
    //for(unsigned i=0;i<__NPIGT13__;i++)
    //		w[i] = fabs(w[i]);


    px[0] = -.1111111111111111*pts[0]-.1111111111111112*pts[2]-.1111111111111110*pts[4]+.4444444444444440*pts[6]+.4444444444444444*pts[8]+.4444444444444448*pts[10];
    px[1] = -0.1983562004520808e-1*pts[0]-.1247859219717828*pts[2]-.1247859219717827*pts[4]+.4991436878871300*pts[6]+.2711200882145115*pts[8]+.4991436878871320*pts[10];
    //px[2] = -0.1983562004520808e-1*pts[0]-.1247859219717828*pts[2]-.1247859219717827*pts[4]+.4991436878871300*pts[6]+.2711200882145115*pts[8]+.4991436878871320*pts[10];
    //px[3] = -0.1983562004520808e-1*pts[0]-.1247859219717828*pts[2]-.1247859219717827*pts[4]+.4991436878871300*pts[6]+.2711200882145115*pts[8]+.4991436878871320*pts[10];
    px[4] = .6431548250191300*pts[0]-0.5664624229410951e-1*pts[2]-0.5664624229410951e-1*pts[4]+.2265849691764380*pts[6]+0.1696772121621298e-1*pts[8]+.2265849691764380*pts[10];
    //px[5] = .6431548250191300*pts[0]-0.5664624229410951e-1*pts[2]-0.5664624229410951e-1*pts[4]+.2265849691764380*pts[6]+0.1696772121621298e-1*pts[8]+.2265849691764380*pts[10];
    //px[6] = .6431548250191300*pts[0]-0.5664624229410951e-1*pts[2]-0.5664624229410951e-1*pts[4]+.2265849691764380*pts[6]+0.1696772121621298e-1*pts[8]+.2265849691764380*pts[10];
    px[7] = .1767777752673147*pts[0]-.1170958588241221*pts[2]-0.4394882179288247e-1*pts[4]+.7989886309132928*pts[6]+0.6093407874470124e-1*pts[8]+.1243441956916957*pts[10];
    //px[8] = .1767777752673147*pts[0]-.1170958588241221*pts[2]-0.4394882179288247e-1*pts[4]+.7989886309132928*pts[6]+0.6093407874470124e-1*pts[8]+.1243441956916957*pts[10];
    //px[9] = .1767777752673147*pts[0]-.1170958588241221*pts[2]-0.4394882179288247e-1*pts[4]+.7989886309132928*pts[6]+0.6093407874470124e-1*pts[8]+.1243441956916957*pts[10];
    //px[10] = .1767777752673147*pts[0]-.1170958588241221*pts[2]-0.4394882179288247e-1*pts[4]+.7989886309132928*pts[6]+0.6093407874470124e-1*pts[8]+.1243441956916957*pts[10];
    //px[11] = .1767777752673147*pts[0]-.1170958588241221*pts[2]-0.4394882179288247e-1*pts[4]+.7989886309132928*pts[6]+0.6093407874470124e-1*pts[8]+.1243441956916957*pts[10];
    //px[12] = .1767777752673147*pts[0]-.1170958588241221*pts[2]-0.4394882179288247e-1*pts[4]+.7989886309132928*pts[6]+0.6093407874470124e-1*pts[8]+.1243441956916957*pts[10];

    px[2]=px[3]=px[1];
    px[5]=px[6]=px[4];
    px[8]=px[9]=px[10]=px[11]=px[12]=px[7];

    py[0] = -.1111111111111111*pts[1]-.1111111111111112*pts[3]-.1111111111111110*pts[5]+.4444444444444440*pts[7]+.4444444444444444*pts[9]+.4444444444444448*pts[11];
    py[1] = -0.1983562004520808e-1*pts[1]-.1247859219717828*pts[3]-.1247859219717827*pts[5]+.4991436878871300*pts[7]+.2711200882145115*pts[9]+.4991436878871320*pts[11];
    //py[2] = -0.1983562004520808e-1*pts[1]-.1247859219717828*pts[3]-.1247859219717827*pts[5]+.4991436878871300*pts[7]+.2711200882145115*pts[9]+.4991436878871320*pts[11];
    //py[3] = -0.1983562004520808e-1*pts[1]-.1247859219717828*pts[3]-.1247859219717827*pts[5]+.4991436878871300*pts[7]+.2711200882145115*pts[9]+.4991436878871320*pts[11];
    py[4] = .6431548250191300*pts[1]-0.5664624229410951e-1*pts[3]-0.5664624229410951e-1*pts[5]+.2265849691764380*pts[7]+0.1696772121621298e-1*pts[9]+.2265849691764380*pts[11];
    //py[5] = .6431548250191300*pts[1]-0.5664624229410951e-1*pts[3]-0.5664624229410951e-1*pts[5]+.2265849691764380*pts[7]+0.1696772121621298e-1*pts[9]+.2265849691764380*pts[11];
    //py[6] = .6431548250191300*pts[1]-0.5664624229410951e-1*pts[3]-0.5664624229410951e-1*pts[5]+.2265849691764380*pts[7]+0.1696772121621298e-1*pts[9]+.2265849691764380*pts[11];
    py[7] = .1767777752673147*pts[1]-.1170958588241221*pts[3]-0.4394882179288247e-1*pts[5]+.7989886309132928*pts[7]+0.6093407874470124e-1*pts[9]+.1243441956916957*pts[11];
    //py[8] = .1767777752673147*pts[1]-.1170958588241221*pts[3]-0.4394882179288247e-1*pts[5]+.7989886309132928*pts[7]+0.6093407874470124e-1*pts[9]+.1243441956916957*pts[11];
    //py[9] = .1767777752673147*pts[1]-.1170958588241221*pts[3]-0.4394882179288247e-1*pts[5]+.7989886309132928*pts[7]+0.6093407874470124e-1*pts[9]+.1243441956916957*pts[11];
    //py[10] = .1767777752673147*pts[1]-.1170958588241221*pts[3]-0.4394882179288247e-1*pts[5]+.7989886309132928*pts[7]+0.6093407874470124e-1*pts[9]+.1243441956916957*pts[11];
    //py[11] = .1767777752673147*pts[1]-.1170958588241221*pts[3]-0.4394882179288247e-1*pts[5]+.7989886309132928*pts[7]+0.6093407874470124e-1*pts[9]+.1243441956916957*pts[11];
    //py[12] = .1767777752673147*pts[1]-.1170958588241221*pts[3]-0.4394882179288247e-1*pts[5]+.7989886309132928*pts[7]+0.6093407874470124e-1*pts[9]+.1243441956916957*pts[11];

    py[2]=py[3]=py[1];
    py[5]=py[6]=py[4];
    py[8]=py[9]=py[10]=py[11]=py[12]=py[7];


}


double MC::TriangleElement::evalIntegral(MC::Polynomial2D &function)
{
    double sum = 0.;

    for(unsigned i=0;i<13;i++)
        sum += function(px[i],py[i])*w[i];

    return .5*sum;
}


void MC::TriangleElement::draw(void)
{
    double dl = 0.1;

    glColor4d(0.9, 1.0, 0.5, 1.0);
        glPointSize(5.0);
        glBegin(GL_POINTS);{
            for(double l1=0.0; l1<=1.0; l1+=dl)
                for(double l2=0.0; l2<=1.0-l1; l2+=dl)
                    glVertex2d(X(l1,l2), Y(l1,l2));
        }
        glEnd();

    for(double l1=0.0; l1<1.0; l1+=dl){

        glBegin(GL_TRIANGLE_STRIP);
        for(double l2=0.0; l2<=1.0-l1-dl; l2+=dl){
            glVertex2d(X(l1,l2), Y(l1,l2));
            glVertex2d(X(l1+dl,l2), Y(l1+dl,l2));
        }
        glVertex2d(X(l1,1.0-l1), Y(l1,1.0-l1));
        glEnd();

    }

}
